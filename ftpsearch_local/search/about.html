<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">

<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<link rel="stylesheet" href="base.css" type="text/css">
<title>BryanskTel | About | by anCHORiTe</title>
</head>
<body>

<div align="center"><h2 style="color: green">О поисковике по FTP-серверам локальной сети БрянскТел</h2></div>
<h2 style="color: blue">Содержание</h2>
<ol>
<li><a href="#reason">Предпосылки создания</a>
<li><a href="#osreal">Особенности реализации</a>
<li><a href="#zamech">Замечания</a>
<li><a href="#warn">Осторожно!</a>
<li><a href="#stats">Что такое статистика?</a>
<li><a href="#browser">Что такое "Браузер FTP" и зачем он нужен?</a>
<li><a href="#direrr">Почему при щелчке на ссылке на каталог в результатах поиска я не попадаю на FTP-сервер?</a>
<li><a href="#about">На чем написан поисковик и как он работает?</a>
<li><a href="#feedback">Обратная связь</a>
<li><a href="#thanks">Благодарности</a>
<li><a href="#author">Об авторе</a>
</ol>
<hr>

<h2 style="color: blue"><a name="reason">Предпосылки создания</a></h2>
Предыдущая версия поисковика (который ранее находился по адресу <b>http://192.168.96.2/cgi-bin/search</b>) по фтп <b>БрянскТел</b> имела следующие недостатки:
<ul>
<li>Большая нагрузка на фтп-сервер (больше 90% CPU);
<li>Неудовлетворительное время поиска (более 30 секунд на каждый запрос).
</ul>
В связи с этим, решено было переписать поисковик "с нуля" и разместить на постоянном адресе, на котором он и находится c <b>10 января 2008г</b> - <a href="http://ftpsearch.bryansktel.ru">http://ftpsearch.bryansktel.ru</a>.

<h2 style="color: blue"><a name="osreal">Особенности реализации</a></h2> 
<ul>
<li>Возможность поиска по нескольким словам, разделенным пробелами;
<li>Возможность задавать интервал поиска по размеру (т.е. одновременно "<b>от</b>" и "<b>до</b>") в <b>килобайтах</b> (для справки: используется каноническое правило <b>1 кб = 1024 байт</b>, а не "десятичные" размеры, принятые буржуйскими производителями винчестеров и DVD-дисков); также можно указывать только одну границу диапазона - поисковик для неуказанного значения "<b>от</b>" подставит <b>0 байт</b>, а для неуказанного значения "<b>до</b>" - <b>100 терабайт</b>;
<li>Информация о <b>реальном</b> размере директории (размер директории = сумма размеров файлов, входящих в нее и во все поддиректории);
<li>Если запрос возвращает большое количество ссылок (а именно <b>больше 100</b>), то на экран информация выводится страницами (<b>по 100 ссылок</b>). Перемещаться между страницами можно по ссылкам внизу страницы;
<li>Показывается такая информация, как общее число совпадений (вверху страницы) и время выполнения запроса (внизу страницы);
<li>Показывается время последнего сканирования каждого файла (это нужно, например, для проверки актуальности ссылки: чем "старее" время сканирования, тем меньше вероятность нахождения файла по указанному адресу);
<li>По умолчанию происходит сортировка результатов запроса <b>в возрастающем порядке</b> по алфавиту: сначала по названию содержащей файл директории, при совпадении же директорий - по имени файла;
<li>Возможность сортировки результатов поиска по размеру (галочка "<b>Сортировать по размеру</b>"): сначала сортировка <b>по убыванию</b> по размеру файла, при равенстве размеров - сортировка по умолчанию;
<li>Возможность выбора между режимами поиска: "<b>Все слова (И)</b>" (по умолчанию) или "<b>Любое из слов (ИЛИ)</b>";
<li>Возможность поиска в разных категориях: "<b>Только файлы</b>" и "<b>Только папки</b>". По умолчанию поиск ведется в обеих категориях (категория "<b>Файлы и папки</b>");
<li>Возможность искать в полном пути (т.е. используется одновременно вся файловая иерархия) - для этого нужно поставить соответствующую галочку. Например, нужно найти альбом <b>Once</b> группы <b>Nightwish</b>. Поиск по двум словам одновременно (т.е. строка запроса - "<b>once nightwish</b>") результата не дает, а поиск по названию альбома даст в итоге ссылки более чем на 400 файлов. Выход - поставить галочку "<b>Искать в полном пути</b>" и ввести "<b>nightwish once</b>". 
</ul>

<h2 style="color: blue"><a name="zamech">Замечания</a></h2>
<ul>
<li>Предположительно база данных будет обновляться один раз в сутки (около 5 часов утра);
<li>Использование галочки "<b>Искать в полном пути</b>" существенно замедляет время поиска (на порядок). <b>Не злоупотребляйте</b> этой функцией, иначе из-за сильных нагрузок на сервер придется эту возможность убрать;
<li><i>Хотя бы одно</i> <b>допустимое</b> слово (т.е. слово после вырезания символов '<b>*</b>', '<b>%</b>', '<b>_</b>', '<b>@</b>') запроса должно быть <b>не меньше 3-х символов</b> в случае поиска по всем словам (или <i>все</i> допустимые слова должны быть <b>не меньше 3-х символов</b> в случае поиска по любому из слов); 
<li>Регулярные выражения (типа * и пр.) <b>не поддерживаются</b> (однако в силу того, что многие help не читают и ставят '<b>*</b>' везде и повсюду, этот знак при предварительной обработке запроса заменяется на пробел);
<li>Поиск <b>регистроНЕзависимый</b>;
<li>При щелчке на ссылке с русскими символами в <b>Internet Explorer</b> откроется соотв. директория или будет предложено скачать файл, если заблаговременно <b>зажать SHIFT</b>.
</ul>

<h2 style="color: red"><a name="warn">Осторожно!</a></h2>
На сервере ведется лог, в котором отмечаются все ваши запросы (а также время и <b>IP</b>-адрес), причем информация в лог пишется раньше, чем происходит разбор строки запроса - соотв., даже если Вы умудритесь сделать <b>SQL Injection</b> или соорудить нереальное выражение, которое повесит сервер - данные все равно будут уже отображены в логе. Так что поаккуратнее ;-)

<h2 style="color: blue"><a name="stats">Что такое статистика?</a></h2>
Для получения информации о проиндексированной информации на текущий момент, а также для показа статистики использования поисковика, была сделана страница, доступная по ссылке <a href="http://ftpsearch.bryansktel.ru/ftpstats.pl"><b>Статистика</b></a> с основной странцы поиска, и включающая в себя такие пункты как:
<ul>
<li><b>Общая статистика</b> (включающая в себя число файлов и общий объем проиндексированных данных, а также общее количество успешных запросов);
<li><b>TOP 20 запросов</b>;
<li><b>TOP 20 ищущих</b>.
</ul>

<h2 style="color: blue"><a name="browser">Что такое "Браузер FTP" и зачем он нужен?</a></h2>
<b>Браузер FTP БрянскТел</b> (доступный по ссылке <a href="http://ftpsearch.bryansktel.ru/ftpdir.pl"><b>Браузер FTP</b></a> с основной странцы поиска) - это своего рода проводник по FTP, построенный на основе его файловой иерархии. Его отличие от использования фтп-клиента следующие:
<ol>
<li>При перемещении по файловой иерархии (щелкая по ссылкам на названия директорий), на самом деле Вы видите всего лишь специально организованную информацию из <b>Базы Данных</b>;
<li>В силу п.1 не создается отдельного фтп-соединения с сервером, в силу чего снижается нагрузка на него;
<li>В силу п.2, при временном падении уже проиндексированного сервера, Вы все равно сможете смотреть содержимое его папок;
<li>В фтп-клиенте нельзя просто взять и посмотреть размер директории вместе со всеми файлами и поддиректориями (для этого придется запускать рекурсивный подсчет), в браузере FTP отображается уже подсчитанный на этапе <b>индексации</b> общий размер.
</ol>

<h2 style="color: blue"><a name="direrr">Почему при щелчке на ссылке на каталог в результатах поиска я не попадаю на FTP-сервер?</a></h2>
Потому что Вы попадаете в <b>Браузер FTP БрянскТел</b> для просмотра содержимого запрошенного Вами каталога. Если же Вам нужна реальная ссылка на сервер, то просто щелкните в открывшемся окне на название запрошенной папки (после слова "<b>Содержимое</b>"). А вот ссылки на обычные файлы ведут на сервер как в результатах поиска, так и в браузере FTP.

<h2 style="color: blue"><a name="about">На чем написан поисковик и как он работает?</a></h2>
Поисковик состоит из трех концептуальных частей:
<ul>
<li><b>Индексатор</b>;
<li><b>База данных</b>;
<li>Собственно, сам <b>CGI-интерфейс поиска</b>.
</ul>
Его работу вкратце можно описать следующим образом:
<ol>
<li><i>Индексатор</i> - это программа, написанная на языке <b>Perl</b>, которая соединяется с фтп-сервером (или уже находится на нем - зависит от конкретной реализации) и производит его полное сканирование. 
<li>Все данные о просканированных файлах заносятся в <i>базу данных</i> (<b>MySQL</b>, <b>Oracle</b>, <b>PostgreSQL</b> - опять же зависит от конкретной реализации) - это полный путь, имя файла, признак каталога, размер, время сканирования. 
<li>И уже заключительный этап - взаимодействие через <i>CGI-интерфейс</i> с конечным пользователем - это и есть та страничка, которую вы используете для поиска. Этот интерфейс также написан на <b>Perl</b>, однако вместо стандартного тяжеловесного (но и в то же время универсального) модуля <b>CGI.pm</b> используются легкие и функциональные модули <b>CGI::WebIn</b> и <b>CGI::WebOut</b> от <b>Дмитрия Котерова</b> (<a href="http://www.dklab.ru">http://www.dklab.ru</a>).
</ol>

<h2 style="color: blue"><a name="feedback">Обратная связь</a></h2>
Все свои замечания и предложения, а также о найденных багах просьба писать в форуме <b>GlobalNet</b> в специально созданной для этого теме - <a href="http://forum.bryansktel.ru/viewtopic.php?t=2644">http://forum.bryansktel.ru/viewtopic.php?t=2644</a>.

<h2 style="color: blue"><a name="thanks">Благодарности</a></h2> 
Благодарю <a href="http://forum.bryansktel.ru/profile.php?mode=viewprofile&u=3">xtreme</a> за преодоление всевозможных технических трудностей, связанных с размещением поисковика на виртуальном хосте, созданием базы данных и предоставлением хостинга :)

<h2 style="color: blue"><a name="author">Об авторе</a></h2>
Поисковик полностью написан <a href="http://forum.bryansktel.ru/profile.php?mode=viewprofile&u=447"><font color="green"><b>anCHORiTe</b></font></a>: <a href="http://www.icq.com/whitepages/about_me.php?uin=307514851">ICQ</a>, <a href="mailto:petsan@newmail.ru">e-mail</a>, <a href="http://www.sql-ex.ru/users_page.php?uid=29233">www</a>.

</body>
</html>
